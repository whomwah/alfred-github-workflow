#!/usr/bin/env sh

VERSION=$1

echo "updating VERSION to $VERSION in info.plist... âœ…"
/usr/libexec/PlistBuddy -c "Set :version $VERSION" info.plist

echo "bundle and minify workflow... âœ…"
deno bundle mod.ts | esbuild --minify-whitespace --minify-identifiers > mod.min.js

echo "confirm releases dir... âœ…"
mkdir -p releases

echo "build releases/alfred-github-workflow.$VERSION.zip... âœ…"
zip -r "releases/alfred-github-workflow.$VERSION.zip" icon.png icons mod.min.js info.plist
mv "releases/alfred-github-workflow.$VERSION.zip" "releases/github.$VERSION.alfredworkflow"

echo "cleanup... âœ…"
rm mod.min.js

echo
echo "New release created! [$VERSION] ðŸ¥³"
